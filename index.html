<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CarpetVue â€“ Visualizer (A1 Simple)</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #ffffff;
    color: #000;
    display: flex;
    height: 100vh;
  }

  /* LEFT PANEL */
  .sidebar {
    width: 280px;
    background: #ffffff;
    border-right: 1px solid #ddd;
    padding: 20px;
    overflow-y: auto;
  }

  .sidebar h2 {
    font-size: 22px;
    margin-bottom: 15px;
    text-align: center;
  }

  .sidebar input[type=file] {
    width: 100%;
    margin-bottom: 12px;
    padding: 10px;
    background: #4db8ff;
    color: black;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  .thumbs {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 20px;
  }

  .thumbs img {
    width: 100%;
    height: 65px;
    object-fit: cover;
    border: 2px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
  }

  label {
    font-size: 14px;
    display: block;
    margin-bottom: 4px;
  }

  .sidebar input[type=range] {
    width: 100%;
    margin-bottom: 18px;
  }

  button {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    background: #4db8ff;
    color: black;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
  }

  button:hover {
    opacity: 0.85;
  }

  /* CANVAS AREA */
  .canvas-wrap {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fafafa;
  }

  canvas {
    max-width: 95%;
    max-height: 95%;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>

<div class="sidebar">
  <h2>CarpetVue</h2>

  <input type="file" id="roomUpload" accept="image/*" value="">
  <input type="file" id="carpetUpload" accept="image/*" value="">

  <div class="thumbs">
    <img src="https://i.imgur.com/jDxHH9g.jpeg" class="sampleRoom">
    <img src="https://i.imgur.com/PG6LI9f.jpeg" class="sampleRoom">
    <img src="https://i.imgur.com/xYgRqI4.jpeg" class="sampleRoom">
    <img src="https://i.imgur.com/VyqE2if.jpeg" class="sampleRoom">
  </div>

  <label>Scale</label>
  <input type="range" id="scaleSlider" min="0.3" max="3" step="0.01" value="1">

  <label>Rotate</label>
  <input type="range" id="rotateSlider" min="-180" max="180" step="1" value="0">

  <button id="resetBtn">Reset</button>
  <button id="downloadBtn">Download</button>
</div>

<div class="canvas-wrap">
  <canvas id="canvas"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let roomImg = new Image();
let carpetImg = new Image();

let carpetScale = 1;
let carpetRotation = 0;
let carpetX = 300;
let carpetY = 300;

let dragging = false;
let offsetX = 0;
let offsetY = 0;

/* DRAW FUNCTION */
function draw() {
  if (!roomImg.src) return;

  canvas.width = roomImg.width;
  canvas.height = roomImg.height;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.drawImage(roomImg, 0, 0, canvas.width, canvas.height);

  if (carpetImg.src) {
    ctx.save();
    ctx.translate(carpetX, carpetY);
    ctx.rotate(carpetRotation * Math.PI / 180);
    ctx.scale(carpetScale, carpetScale);
    ctx.drawImage(carpetImg, -carpetImg.width / 2, -carpetImg.height / 2);
    ctx.restore();
  }
}

/* ROOM THUMBNAILS */
document.querySelectorAll(".sampleRoom").forEach(img => {
  img.addEventListener("click", () => {
    roomImg = new Image();
    roomImg.onload = draw;
    roomImg.src = img.src;
  });
});

/* UPLOAD ROOM */
document.getElementById("roomUpload").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  roomImg = new Image();
  roomImg.onload = draw;
  roomImg.src = url;
});

/* UPLOAD CARPET */
document.getElementById("carpetUpload").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  carpetImg = new Image();
  carpetImg.onload = draw;
  carpetImg.src = url;
});

/* SCALE */
document.getElementById("scaleSlider").oninput = e => {
  carpetScale = e.target.value;
  draw();
};

/* ROTATE */
document.getElementById("rotateSlider").oninput = e => {
  carpetRotation = e.target.value;
  draw();
};

/* DRAG CARPET */
canvas.addEventListener("mousedown", e => {
  dragging = true;
  offsetX = e.offsetX - carpetX;
  offsetY = e.offsetY - carpetY;
});

canvas.addEventListener("mousemove", e => {
  if (dragging) {
    carpetX = e.offsetX - offsetX;
    carpetY = e.offsetY - offsetY;
    draw();
  }
});

canvas.addEventListener("mouseup", () => dragging = false);
canvas.addEventListener("mouseleave", () => dragging = false);

/* RESET */
document.getElementById("resetBtn").addEventListener("click", () => {
  carpetScale = 1;
  carpetRotation = 0;
  carpetX = canvas.width / 2;
  carpetY = canvas.height / 2;
  draw();
});

/* DOWNLOAD */
document.getElementById("downloadBtn").addEventListener("click", () => {
  const link = document.createElement("a");
  link.download = "carpetvue_result.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});
</script>

</body>
</html>
