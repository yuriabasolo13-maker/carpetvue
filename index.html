<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CarpetVue – Minimal Carpet Visualizer</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: white;
    margin: 0;
    padding: 20px;
    color: #000;
  }

  h1 {
    text-align: center;
    margin-bottom: 10px;
    font-size: 26px;
  }

  .controls {
    text-align: center;
    margin-bottom: 20px;
  }

  button, input[type=file] {
    background: #4db8ff;
    color: black;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    margin: 6px;
    cursor: pointer;
    font-size: 14px;
  }

  button:hover {
    opacity: 0.8;
  }

  .room-thumbs {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .room-thumbs img {
    width: 90px;
    height: 60px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid #ddd;
    border-radius: 4px;
  }

  canvas {
    display: block;
    margin: 20px auto;
    max-width: 100%;
    border: 1px solid #ccc;
  }

  .sliders {
    text-align: center;
    margin-top: 10px;
  }

  .sliders input {
    width: 60%;
  }
</style>
</head>
<body>

<h1>CarpetVue – Minimal Visualizer</h1>

<div class="controls">
  <input type="file" id="roomUpload" accept="image/*">
  <input type="file" id="carpetUpload" accept="image/*">
  <button id="resetBtn">Reset</button>
  <button id="downloadBtn">Download</button>
</div>

<!-- Room Samples -->
<div class="room-thumbs">
  <img src="https://i.imgur.com/jDxHH9g.jpeg" class="sampleRoom">
  <img src="https://i.imgur.com/PG6LI9v.jpeg" class="sampleRoom">
  <img src="https://i.imgur.com/xYgRqI4.jpeg" class="sampleRoom">
  <img src="https://i.imgur.com/VyqE2if.jpeg" class="sampleRoom">
</div>

<canvas id="canvas"></canvas>

<div class="sliders">
  <label>Scale: </label>
  <input type="range" id="scaleSlider" min="0.2" max="3" step="0.01" value="1">
  <br><br>
  <label>Rotate: </label>
  <input type="range" id="rotateSlider" min="-180" max="180" step="1" value="0">
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let roomImg = new Image();
let carpetImg = new Image();

let carpetScale = 1;
let carpetRotation = 0;

let carpetX = 100;
let carpetY = 100;

let dragging = false;
let dragOffsetX = 0;
let dragOffsetY = 0;

/*** DRAW FUNCTION ***/
function draw() {
  if (!roomImg.src) return;

  canvas.width = roomImg.width;
  canvas.height = roomImg.height;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(roomImg, 0, 0, canvas.width, canvas.height);

  if (carpetImg.src) {
    ctx.save();
    ctx.translate(carpetX, carpetY);
    ctx.rotate(carpetRotation * Math.PI / 180);
    ctx.scale(carpetScale, carpetScale);
    ctx.drawImage(carpetImg, -carpetImg.width / 2, -carpetImg.height / 2);
    ctx.restore();
  }
}

/*** LOAD ROOM SAMPLE ***/
document.querySelectorAll(".sampleRoom").forEach(img => {
  img.addEventListener("click", () => {
    roomImg = new Image();
    roomImg.onload = draw;
    roomImg.src = img.src;
  });
});

/*** UPLOAD ROOM ***/
document.getElementById("roomUpload").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  roomImg = new Image();
  roomImg.onload = draw;
  roomImg.src = url;
});

/*** UPLOAD CARPET ***/
document.getElementById("carpetUpload").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  carpetImg = new Image();
  carpetImg.onload = draw;
  carpetImg.src = url;
});

/*** SCALE ***/
document.getElementById("scaleSlider").oninput = (e) => {
  carpetScale = e.target.value;
  draw();
};

/*** ROTATE ***/
document.getElementById("rotateSlider").oninput = (e) => {
  carpetRotation = e.target.value;
  draw();
};

/*** DRAGGING CARPET ***/
canvas.addEventListener("mousedown", (e) => {
  dragging = true;
  dragOffsetX = e.offsetX - carpetX;
  dragOffsetY = e.offsetY - carpetY;
});

canvas.addEventListener("mousemove", (e) => {
  if (dragging) {
    carpetX = e.offsetX - dragOffsetX;
    carpetY = e.offsetY - dragOffsetY;
    draw();
  }
});

canvas.addEventListener("mouseup", () => dragging = false);
canvas.addEventListener("mouseleave", () => dragging = false);

/*** RESET ***/
document.getElementById("resetBtn").addEventListener("click", () => {
  carpetScale = 1;
  carpetRotation = 0;
  carpetX = canvas.width / 2;
  carpetY = canvas.height / 2;
  draw();
});

/*** DOWNLOAD ***/
document.getElementById("downloadBtn").addEventListener("click", () => {
  const link = document.createElement("a");
  link.download = "carpetvue_output.png";
  link.href = canvas.toDataURL();
  link.click();
});
</script>

</body>
</html>
